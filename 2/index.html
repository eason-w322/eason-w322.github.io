<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CS180 Project 1 — Colorizing the Prokudin-Gorskii Photos</title>
  <link rel="stylesheet" href="styles.css" />
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" defer></script>
</head>
<body>
<header class="site-header">
  <h1>Colorizing the Prokudin-Gorskii Photos</h1>
  <p class="subtitle">CS180/280A • Project 1</p>
</header>

<main class="container">
  <nav class="toc">
    <a href="#overview">Overview</a>
    <a href="#approach">Approach</a>
    <a href="#pyramid">Pyramid</a>
    <a href="#results">Results</a>
    <a href="#other-examples">Other Examples</a> 
  </nav>

  <section class="content">
    <section id="overview" class="card">
      <h2>Overview</h2>
      <p>
        In this project, I reconstruct color images from Prokudin-Gorskii glass plates (top=Blue, middle=Green, bottom=Red) by aligning the G and R channels to B using a windowed search with normalized cross-correlation (NCC) and a coarse-to-fine image-pyramid approach for large <code>.tif</code> files.
      </p>
    </section>

    <section id="approach" class="card">
      <h2>Single-Scale Alignment</h2>
      <p>
        The glass plate is first divided into three equal parts corresponding to the blue, green, and red channels. 
        To minimize boundary artifacts, I crop the central region with a crop fraction of 0.15. 
        Within a search window of [-15, +15], I implement normalized cross-correlation (NCC) to determine the optimal displacement (dy, dx) 
        that maximizes the similarity score. I applied this method to three sample images (shown below). 
        The results demonstrate strong alignment overall, though the outer edges exhibit some color fringing due to border inconsistencies. 
        To address this, I implemented an additional <code>crop_border</code> function, which successfully removes most of the noisy edge artifacts.
      </p>
      <!-- Formula Section -->
      <div class="formula">
        <p><strong>Normalized Cross-Correlation (NCC):</strong></p>
        \[
        NCC(I, J) = \frac{\sum_{x,y} (I(x,y) - \bar{I})(J(x,y) - \bar{J})}
                      {\sqrt{\sum_{x,y} (I(x,y) - \bar{I})^2} \,
                       \sqrt{\sum_{x,y} (J(x,y) - \bar{J})^2}}
        \]
      </div>
      <div class="grid interactive-gallery">
        <figure class="tile clickable">
          <img src="https://raw.githubusercontent.com/eason-w322/CS180-Project-1/main/results/cathedral_rgb.jpg">
          <figcaption>
            <strong>Cathedral</strong>
            <div class="meta">
              G(dy, dx) = (5,2) | R(dy, dx) = (12,3)    Time: 0.121s
            </div>
          </figcaption>
        </figure>

        <figure class="tile clickable">
          <img src="https://raw.githubusercontent.com/eason-w322/CS180-Project-1/main/results/monastery_rgb.jpg">
          <figcaption>
            <strong>Monastery</strong>
            <div class="meta">
              G(dy, dx) = (-3,2) | R(dy, dx) = (3,2)    Time: 0.121s
            </div>
          </figcaption>
        </figure>

        <figure class="tile clickable">
          <img src="https://raw.githubusercontent.com/eason-w322/CS180-Project-1/main/results/tobolsk_rgb.jpg">
          <figcaption>
            <strong>Tobolsk</strong>
            <div class="meta">
              G(dy, dx) = (3,3) | R(dy, dx) = (6,3)    Time: 0.138s
            </div>
          </figcaption>
        </figure>
      </div>
    </section>

    <section id="pyramid" class="card">
      <h2>Image Pyramid (Coarse → Fine)</h2>
      <p>
        However, single-scale alignment with NCC fails to produce well-aligned results for large <code>.tif</code> images, most notably for <strong>Emir</strong>. 
        This happens because NCC assumes consistent relative intensity across channels, but in Emir the brightness varies significantly. 
        These exposure differences make the correlation score noisy, leading to poor alignment.
      </p>
      <p>
        To address this, I implemented a <strong>coarse-to-fine image pyramid</strong>. 
        The image is iteratively downsampled by a factor of two, creating up to six levels. 
        I wrote a function, <code>pick_levels</code>, which automatically determines the appropriate number of pyramid levels 
        based on the original image size, while ensuring a minimum resolution of 200 pixels at the coarsest level.
      </p>
      <p>
        At each level, I compute the <strong>gradient magnitude</strong> of the images and perform NCC to estimate the displacement offsets. 
        Using gradient magnitude rather than raw intensity reduces the influence of brightness and exposure differences, 
        since edges are more stable across channels than absolute intensity values. 
        The offsets are first estimated at the coarsest level, then upscaled and refined progressively at finer resolutions, 
        allowing the algorithm to recover large displacements while still achieving precise pixel-level alignment.
      </p>
      <!-- Formula Section -->
      <div class="formula">
        <p><strong>Gradient Magnitude:</strong></p>
        \[
          |\nabla I| = \sqrt{\left(\frac{\partial I}{\partial x}\right)^2 + \left(\frac{\partial I}{\partial y}\right)^2}
        \]
      </div>
    </section>
    <section id="results" class="card">
  <h2>Results</h2>
  <div class="results-grid">

    <!-- 1. Emir -->
    <div class="result-row">
      <img src="https://raw.githubusercontent.com/eason-w322/CS180-Project-1/main/results/emir_rgb.jpg" alt="Emir">
      <div class="meta"><strong>Emir</strong></div>
      <div class="meta"><strong>G(dy, dx):</strong> (49, 24)</div>
      <div class="meta"><strong>R(dy, dx):</strong> (107, 40)</div>
      <div class="meta"><strong>Processing Time:</strong> 1.921s</div>
    </div>

    <!-- 2. Church -->
    <div class="result-row">
      <img src="https://raw.githubusercontent.com/eason-w322/CS180-Project-1/main/results/church_rgb.jpg" alt="Church">
      <div class="meta"><strong>Church</strong></div>
      <div class="meta"><strong>G(dy, dx):</strong> (25, 4)</div>
      <div class="meta"><strong>R(dy, dx):</strong> (58, -4)</div>
      <div class="meta"><strong>Processing Time:</strong> 1.857s</div>
    </div>

    <!-- 3. Harvesters -->
    <div class="result-row">
      <img src="https://raw.githubusercontent.com/eason-w322/CS180-Project-1/main/results/harvesters_rgb.jpg" alt="Harvesters">
      <div class="meta"><strong>Harvesters</strong></div>
      <div class="meta"><strong>G(dy, dx):</strong> (60, 18)</div>
      <div class="meta"><strong>R(dy, dx):</strong> (124, 13)</div>
      <div class="meta"><strong>Processing Time:</strong> 1.836s</div>
    </div>

    <!-- 4. Icon -->
    <div class="result-row">
      <img src="https://raw.githubusercontent.com/eason-w322/CS180-Project-1/main/results/icon_rgb.jpg" alt="Icon">
      <div class="meta"><strong>Icon</strong></div>
      <div class="meta"><strong>G(dy, dx):</strong> (41, 17)</div>
      <div class="meta"><strong>R(dy, dx):</strong> (90, 23)</div>
      <div class="meta"><strong>Processing Time:</strong> 1.879s</div>
    </div>

    <!-- 5. Italil -->
    <div class="result-row">
      <img src="https://raw.githubusercontent.com/eason-w322/CS180-Project-1/main/results/italil_rgb.jpg" alt="Italil">
      <div class="meta"><strong>Italil</strong></div>
      <div class="meta"><strong>G(dy, dx):</strong> (38, 22)</div>
      <div class="meta"><strong>R(dy, dx):</strong> (77, 36)</div>
      <div class="meta"><strong>Processing Time:</strong> 1.874s</div>
    </div>

    <!-- 6. Lastochikino -->
    <div class="result-row">
      <img src="https://raw.githubusercontent.com/eason-w322/CS180-Project-1/main/results/lastochikino_rgb.jpg" alt="Lastochikino">
      <div class="meta"><strong>Lastochikino</strong></div>
      <div class="meta"><strong>G(dy, dx):</strong> (-3, -1)</div>
      <div class="meta"><strong>R(dy, dx):</strong> (76, -8)</div>
      <div class="meta"><strong>Processing Time:</strong> 1.839s</div>
    </div>

    <!-- 7. Lugano -->
    <div class="result-row">
      <img src="https://raw.githubusercontent.com/eason-w322/CS180-Project-1/main/results/lugano_rgb.jpg" alt="Lugano">
      <div class="meta"><strong>Lugano</strong></div>
      <div class="meta"><strong>G(dy, dx):</strong> (41, -17)</div>
      <div class="meta"><strong>R(dy, dx):</strong> (92, -29)</div>
      <div class="meta"><strong>Processing Time:</strong> 1.879s</div>
    </div>

    <!-- 8. Melons -->
    <div class="result-row">
      <img src="https://raw.githubusercontent.com/eason-w322/CS180-Project-1/main/results/melons_rgb.jpg" alt="Melons">
      <div class="meta"><strong>Melons</strong></div>
      <div class="meta"><strong>G(dy, dx):</strong> (80, 10)</div>
      <div class="meta"><strong>R(dy, dx):</strong> (177, 13)</div>
      <div class="meta"><strong>Processing Time:</strong> 1.887s</div>
    </div>

    <!-- 9. Self Portrait -->
    <div class="result-row">
      <img src="https://raw.githubusercontent.com/eason-w322/CS180-Project-1/main/results/self_portrait_rgb.jpg" alt="Self Portrait">
      <div class="meta"><strong>Self Portrait</strong></div>
      <div class="meta"><strong>G(dy, dx):</strong> (78, 29)</div>
      <div class="meta"><strong>R(dy, dx):</strong> (175, 37)</div>
      <div class="meta"><strong>Processing Time:</strong> 1.926s</div>
    </div>

    <!-- 10. Siren -->
    <div class="result-row">
      <img src="https://raw.githubusercontent.com/eason-w322/CS180-Project-1/main/results/siren_rgb.jpg" alt="Siren">
      <div class="meta"><strong>Siren</strong></div>
      <div class="meta"><strong>G(dy, dx):</strong> (49, -6)</div>
      <div class="meta"><strong>R(dy, dx):</strong> (96, -24)</div>
      <div class="meta"><strong>Processing Time:</strong> 1.902s</div>
    </div>

    <!-- 11. Three Generations -->
    <div class="result-row">
      <img src="https://raw.githubusercontent.com/eason-w322/CS180-Project-1/main/results/three_generations_rgb.jpg" alt="Three Generations">
      <div class="meta"><strong>Three Generations</strong></div>
      <div class="meta"><strong>G(dy, dx):</strong> (53, 12)</div>
      <div class="meta"><strong>R(dy, dx):</strong> (111, 9)</div>
      <div class="meta"><strong>Processing Time:</strong> 1.841s</div>
    </div>

  </div>
</section>
    <section id="other-examples" class="card">
      <h2>Other Examples</h2>
      <div class="results-grid">
        <!-- Example 1 -->
        <div class="result-row">
          <img src=https://raw.githubusercontent.com/eason-w322/CS180-Project-1/main/results/example1_rgb.jpg" alt="Example 1">
          <div class="meta">(57, 13)</div>
          <div class="meta">(125, 24)</div>
          <div class="meta">2.045s</div>
        </div>

        <!-- Example 2 -->
        <div class="result-row">
          <img src=https://raw.githubusercontent.com/eason-w322/CS180-Project-1/main/results/example2_rgb.jpg" alt="Example 2">
          <div class="meta">(57, 13)</div>
          <div class="meta">(125, 24)</div>
          <div class="meta">1.919s</div>
        </div>

        <!-- Example 3 -->
        <div class="result-row">
          <img src=https://raw.githubusercontent.com/eason-w322/CS180-Project-1/main/results/example3_rgb.jpg" alt="Example 3">
          <div class="meta">(63, 8)</div>
          <div class="meta">(138, 6)</div>
          <div class="meta">1.911s</div>
        </div>
      </div>
    </section>
  </section>
</main>

<div id="imageModal" class="modal">
  <span class="close">&times;</span>
  <img class="modal-content" id="modalImg">
  <div id="modalCaption"></div>
</div>

<footer class="site-footer">
  <p>© 2025 Eason Wei • CS180/280A</p>
</footer>

<script src="compare.js"></script>
</body>
</html>
